<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏–º—É–ª—è—Ç–æ—Ä –ü–∞–ø—ã: –ø–æ–¥–º–µ–Ω–∏ –∂–µ–Ω—É</title>
    <style>
        /* CSS –æ—Å—Ç–∞–ª—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —á—Ç–æ–±—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –ª–æ–≥–∏–∫–µ */
        body { 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            background-color: #f0f0f0; 
            font-family: Arial, sans-serif; 
            overflow: hidden; 
            user-select: none; 
            -webkit-user-select: none;
            transition: background-color 0.5s ease;
        }
        .cradle-container {
            position: relative;
            margin-bottom: 30px;
        }
        .cradle { 
            width: 200px; 
            height: 200px; 
            background-color: #fff; 
            border-radius: 50%; 
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            cursor: pointer;
            border: 5px solid #e0e0e0;
        }
        .cradle:active {
            transform: scale(0.95);
        }
        .cradle img { 
            width: 120px; 
            height: 120px; 
            object-fit: contain;
            pointer-events: none; 
        }
        .timer { 
            margin-bottom: 20px; 
            font-size: 24px; 
            font-weight: bold;
            color: #333;
        }
        .status-bar {
            width: 80%;
            max-width: 400px;
            height: 20px;
            background-color: #ddd;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .anxiety-fill {
            height: 100%;
            width: 0%;
            background-color: #4CAF50;
            transition: width 0.2s, background-color 0.5s;
        }
        .action-button { 
            padding: 15px 30px; 
            font-size: 18px; 
            color: white; 
            border: none; 
            border-radius: 25px; 
            cursor: pointer; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°—Ç–∞—Ä—Ç" */
            background-color: #4CAF50; 
        }
        .action-button.end-game {
            /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–∏–∑–≤–∞—Ç—å –ú–∞–º—É" */
            background-color: #f44336; 
        }
        #soundToggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        #soundToggle:hover {
            opacity: 1;
        }
    </style>
</head>
<body>

    <button id="soundToggle">üîä</button> 

    <div class="timer" id="timer">–ù–∞–∂–º–∏—Ç–µ –°—Ç–∞—Ä—Ç</div>
    
    <div class="status-bar">
        <div class="anxiety-fill" id="anxietyBar"></div>
    </div>

    <div class="cradle-container">
        <div class="cradle" id="cradle" style="pointer-events: none;">
            <img id="baby" src="baby_happy.png" alt="Baby">
        </div>
    </div>

    <button class="action-button" id="mainActionButton">–°—Ç–∞—Ä—Ç!</button>

    <script>
        /* --- –ó–í–£–ö–û–í–ê–Ø –°–ï–ö–¶–ò–Ø --- */
        let isSoundOn = true;
        const soundHappy = new Audio('happy.mp3');
        const soundCrying = new Audio('crying.mp3');
        soundCrying.loop = true; 
        const soundRock = new Audio('rock_cradle.mp3');

        function playSound(audioObject) {
            if (isSoundOn) {
                audioObject.currentTime = 0;
                // –í–ê–ñ–ù–û: .catch() –ø–æ–º–æ–≥–∞–µ—Ç –æ–±–æ–π—Ç–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö
                audioObject.play().catch(e => console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:", e));
            }
        }

        function stopSound(audioObject) {
            audioObject.pause();
            audioObject.currentTime = 0;
        }

        const soundToggleButton = document.getElementById('soundToggle');
        soundToggleButton.addEventListener('click', () => {
            isSoundOn = !isSoundOn;
            soundToggleButton.textContent = isSoundOn ? 'üîä' : 'üîá';
            
            if (!isSoundOn) {
                stopSound(soundCrying);
            } else if (anxietyLevel >= 50) {
                playSound(soundCrying);
            }
        });
        /* ------------------------- */


        /* --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ --- */
        let anxietyLevel = 0;
        let totalTime = 0;
        let calmTime = 0;
        let cryingTime = 0;
        let timerInterval;
        let isCrying = false;
        let isGameRunning = false; // –ù–û–í–´–ô –§–õ–ê–ì

        const CRYING_LIMIT = 50; // –ù–û–í–û–ï: –õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ –ø–ª–∞—á–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
        
        const BASE_ANXIETY_GAIN = 5; 
        const MAX_ANXIETY_GAIN = 10; 
        let currentAnxietyGain = BASE_ANXIETY_GAIN; 
        
        const cradle = document.getElementById('cradle');
        const baby = document.getElementById('baby');
        const timerDisplay = document.getElementById('timer');
        const mainActionButton = document.getElementById('mainActionButton');
        const anxietyBar = document.getElementById('anxietyBar');
        const body = document.body;

        function updateCradle() {
            anxietyBar.style.width = anxietyLevel + "%";
            
            if (anxietyLevel < 50) {
                baby.src = "baby_happy.png"; 
                body.style.backgroundColor = "#f0f0f0";
                anxietyBar.style.backgroundColor = "#4CAF50"; 
                
                if (isCrying) { 
                    stopSound(soundCrying);
                    playSound(soundHappy);
                    isCrying = false;
                }
                
            } else {
                baby.src = "baby_crying.png"; 
                body.style.backgroundColor = "#ffebee"; 
                anxietyBar.style.backgroundColor = "#f44336"; 
                
                if (!isCrying) { 
                    playSound(soundCrying);
                    isCrying = true;
                }
            }
        }

        function updateTimer() {
            totalTime++;
            if (anxietyLevel < 50) {
                calmTime++;
            } else {
                cryingTime++;
                
                // *** –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –ü–†–û–í–ï–†–ö–ê –õ–ò–ú–ò–¢–ê –ü–õ–ê–ß–ê ***
                if (cryingTime >= CRYING_LIMIT) {
                    endGame("failure");
                    return; // –í—ã—Ö–æ–¥–∏–º, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏–≥—Ä—É
                }
            }

            const minutes = Math.floor(totalTime / 60).toString().padStart(2, '0');
            const seconds = (totalTime % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `–í—ã –ø—Ä–æ–¥–µ—Ä–∂–∞–ª–∏—Å—å: ${minutes}:${seconds}`;
        }

        cradle.addEventListener('click', () => {
            if (!isGameRunning) return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫–∏, –µ—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –∏–¥–µ—Ç

            playSound(soundRock); 
            anxietyLevel = Math.max(0, anxietyLevel - 10);
            
            currentAnxietyGain *= 2; 
            currentAnxietyGain = Math.min(MAX_ANXIETY_GAIN, currentAnxietyGain);

            cradle.style.transition = 'transform 2s ease-in-out';
            cradle.style.transform = 'rotate(-5deg)'; 
            
            setTimeout(() => {
                cradle.style.transform = 'rotate(5deg)';
            }, 1000); 
            
            setTimeout(() => {
                cradle.style.transform = 'rotate(0deg)';
                cradle.style.transition = 'none'; 
            }, 2000); 

            updateCradle();
        });

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function startGame() {
            isGameRunning = true;
            cradle.style.pointerEvents = 'auto'; // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–ª–∏–∫ –ø–æ –∫–æ–ª—ã–±–µ–ª–∏
            mainActionButton.textContent = "–ü—Ä–∏–∑–≤–∞—Ç—å –ú–∞–º—É"; // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            mainActionButton.classList.add('end-game'); // –ú–µ–Ω—è–µ–º —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏
            
            timerInterval = setInterval(() => {
                anxietyLevel = Math.min(100, anxietyLevel + currentAnxietyGain); 
                updateCradle();
                updateTimer();
            }, 1000);
        }

        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã (—Å –ø—Ä–∏—á–∏–Ω–æ–π)
        function endGame(reason) {
            clearInterval(timerInterval);
            isGameRunning = false;
            cradle.style.pointerEvents = 'none'; // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–ª–∏–∫
            stopSound(soundCrying);
            
            const successRate = totalTime > 0 ? (calmTime / totalTime) * 100 : 0;
            let achievement = "";
            let endMessage = "";

            if (reason === "failure") {
                endMessage = `–ü–û–†–ê–ñ–ï–ù–ò–ï! –†–µ–±–µ–Ω–æ–∫ –ø–ª–∞–∫–∞–ª ${CRYING_LIMIT} —Å–µ–∫—É–Ω–¥ –ø–æ–¥—Ä—è–¥!`;
            } else {
                endMessage = "–°–º–µ–Ω–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. –†–∞—Å—Å–ª–∞–±—å—Ç–µ—Å—å.";
            }

            if (successRate > 90) {
                achievement = "üèÜ –û—Ç–µ—Ü –ì–æ–¥–∞ 2026!";
            } else if (successRate > 70) {
                achievement = "üåü –ú–∞—Å—Ç–µ—Ä –û—Ç–µ—Ü: –†–µ–±–µ–Ω–æ–∫ –¥–æ–≤–æ–ª–µ–Ω!";
            } else if (successRate > 50) {
                achievement = "üòê –í—ã —Å—Ç–∞—Ä–∞–ª–∏—Å—å! –°—Ä–µ–¥–Ω—è—è —Å–Ω–æ—Ä–æ–≤–∫–∞, –Ω–æ...";
            } else {
                achievement = "üö® –°–æ—Å–µ–¥–∏ –≤—ã–∑–≤–∞–ª–∏ –ø–æ–ª–∏—Ü–∏—é. –£ –≤–∞—Å –µ—Å—Ç—å 15 —Å—É—Ç–æ–∫ –ø–æ–¥—É–º–∞—Ç—å –æ —Å–≤–æ–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏.";
            }

            alert(`${endMessage}\n\n–¢–∏—à–∏–Ω–∞: ${successRate.toFixed(0)}%\n–í–∞—à–µ –∑–≤–∞–Ω–∏–µ: ${achievement}`);
            location.reload(); 
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
        mainActionButton.addEventListener('click', () => {
            if (!isGameRunning) {
                startGame();
            } else {
                // –ï—Å–ª–∏ –∏–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞, –∫–Ω–æ–ø–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
                endGame("manual"); 
            }
        });
    </script>
</body>
</html>